rules:
  - id: logger-message
    languages:
      - js
    message: logger methods called with objects as argument, must contain "msg" to appear as a message in Kibana
    patterns:
      - pattern-inside: |
          const { getLogger } = require('@open-condo/keystone/logging')
          ...
          const $LOGGER = getLogger(...)
          ...
      - pattern: $LOGGER.$METHOD({ ... })
      - pattern-not: '$LOGGER.$METHOD({ ..., msg: $MSG, ... })'
    severity: ERROR

  - id: deprecated-server-side-graphql-client
    languages:
      - js
    message: This utils are incompatible with Keystone 6. Additionally, we are attempting to address a problem that can readily be resolved using existing utilities, such as the `execGqlAsUser` function. Recommended data access techniques are described in apps/condo/docs/development/data-access.md
    patterns:
      - pattern-inside: const { ... } = require('@keystonejs/server-side-graphql-client')
      - pattern: '$GETTER'
      - metavariable-regex:
          metavariable: '$GETTER'
          regex: '^get\w+$'
    metadata:
      references:
        - condo/apps/condo/docs/development/data-access.md
    severity: WARNING
