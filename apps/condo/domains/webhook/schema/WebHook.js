/**
 * Generated by `createschema webhook.WebHook 'name:Text; url:Url; description:Text'`
 */

const { Text, Relationship } = require('@keystonejs/fields')
const { GQLListSchema } = require('@condo/keystone/schema')
const { historical, versioned, uuided, tracked, softDeleted } = require('@condo/keystone/plugins')
const { dvAndSender } = require('@condo/domains/common/schema/plugins/dvAndSender')
const access = require('@condo/domains/webhook/access/WebHook')
const { webhook } = require('@condo/domains/webhook/schema/plugins/webhook')


const WebHook = new GQLListSchema('WebHook', {
    schemaDoc: 'WebHooks are a way that the APP can send automated web callback with some messages to other apps or system to inform them about any updates. ' +
        'How does it work: 1. When objects are changed, we make requests to the GraphQL API to get data on behalf of the service user; 2. Then we send the data to remote url.',
    fields: {
        name: {
            schemaDoc: 'Short name',
            type: 'Text',
            isRequired: true,
        },

        url: {
            schemaDoc: 'Target webhook url',
            type: 'Url',
            isRequired: true,
        },

        user: {
            schemaDoc: 'The user on whose behalf a request is being made to the GraphQL API to prepare webhook data',
            type: 'Relationship',
            ref: 'User',
            isRequired: true,
            knexOptions: { isNotNullable: true }, // Relationship only!
            kmigratorOptions: { null: false, on_delete: 'models.CASCADE' },
        },

        description: {
            schemaDoc: 'Who? Why? What the reason and that the purpose of this hook?',
            type: Text,
            isRequired: false,
        },
    },
    plugins: [uuided(), versioned(), tracked(), softDeleted(), dvAndSender(), historical(), webhook()],
    access: {
        read: access.canReadWebHooks,
        create: access.canManageWebHooks,
        update: access.canManageWebHooks,
        delete: false,
        auth: true,
    },
})

module.exports = {
    WebHook,
}
