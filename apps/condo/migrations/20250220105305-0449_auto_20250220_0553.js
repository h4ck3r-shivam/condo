// auto generated by kmigrator
// KMIGRATOR:0449_auto_20250220_0553:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDUuMSBvbiAyMDI1LTAyLTIwIDA1OjUzCgpmcm9tIGRqYW5nby5kYiBpbXBvcnQgbWlncmF0aW9ucwoKCmNsYXNzIE1pZ3JhdGlvbihtaWdyYXRpb25zLk1pZ3JhdGlvbik6CgogICAgZGVwZW5kZW5jaWVzID0gWwogICAgICAgICgnX2RqYW5nb19zY2hlbWEnLCAnMDQ0OF91c2Vyc3Vkb3Rva2VuaGlzdG9yeXJlY29yZF91c2Vyc3Vkb3Rva2VuJyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgIF0K

const { getKVClient, checkMinimalKVDataVersion } = require('@open-condo/keystone/kv')

exports.up = async () => {
    await checkMinimalKVDataVersion(2)
}

exports.down = async () => {
    const kv = getKVClient()
    const versionString = await kv.get('data_version')
    const dbSize = await kv.dbsize()
    // Rollback "empty db" if statement, since non-empty one mutates nothing
    if (dbSize === 1 && versionString === '2') {
        await kv.del('data_version')
    }
}
